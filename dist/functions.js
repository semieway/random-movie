const TMDB_API="2cd07807d06f27e9501bcd4674d3c757",OMDB_API="380457ba";export function renderMovie(e=null){getMovieInfo(e).then(e=>{document.querySelector(".title").textContent=e.title;let t=new Date(e.release_date);document.querySelector(".year").textContent="("+t.getFullYear()+")";let r=e.poster_path?"https://image.tmdb.org/t/p/w500"+e.poster_path:"../images/poster-placeholder.png";document.querySelector(".poster img").src=r,document.querySelector(".genres").textContent=e.genres.reduce((e,t)=>e+t.name+", ","").slice(0,-2),document.querySelector(".certification").textContent=e.certification?e.certification:"N/A";document.querySelector(".release").textContent=Intl.DateTimeFormat("en-GB",{day:"numeric",month:"short",year:"numeric"}).format(t);let o=Math.floor(e.runtime/60),i=e.runtime%60;document.querySelector(".runtime-hours-value").textContent=o,document.querySelector(".runtime-minutes-value").textContent=i;let n=document.querySelector(".countries");n.innerHTML="";for(let t of e.countries.reverse().splice(0,3)){let e=t.iso_3166_1.toLowerCase(),r=document.createElement("span");r.classList.add("country-flag","flag-icon","flag-icon-"+e),n.append(r)}document.querySelector(".directors-name").textContent=e.director?e.director:"Not available",document.querySelector(".writers-name").textContent=e.writer?e.writer:"Not available",document.querySelector(".imdb-info").textContent=e.imdb_votes;let a=document.querySelector(".overview");a.textContent=e.overview;let l=document.createElement("div");l.classList.add("tagline"),l.textContent=e.tagline,a.prepend(l);let c=document.querySelector(".cast-list");c.innerHTML="";for(let t of e.cast){let e=document.createElement("div");e.classList.add("actor");let r=document.createElement("img");r.classList.add("actor-image");let o=t.profile_path?"https://image.tmdb.org/t/p/w276_and_h350_face"+t.profile_path:"../images/actor-placeholder.png";r.src=o,e.append(r);let i=document.createElement("div");i.classList.add("actor-info");let n=document.createElement("div");n.classList.add("actor-name"),n.textContent=t.name,i.append(n);let a=document.createElement("div");a.classList.add("actor-character"),a.textContent=t.character,i.append(a),e.append(i),c.append(e)}let s=document.querySelector(".trailer");e.trailer?(s.hidden=!1,s.src="https://www.youtube.com/embed/"+e.trailer):s.hidden=!0;let d,u=document.querySelector(".imdb-link");e.imdbId&&"N/A"!=e.imdbId?(d="https://www.imdb.com/title/"+e.imdbId,u.setAttribute("href",d)):u.removeAttribute("href");let m=document.querySelector(".metacritic-link");e.metacritic_rating&&"N/A"!=e.metacritic_rating?m.setAttribute("href","https://www.metacritic.com/movie/"+e.title.toLowerCase().replace(/[:'()&.,…]/g,"").replace(/\s+/g,"-")):m.removeAttribute("href"),showImdbRating("N/A"==e.imdb_rating||null==e.imdb_rating?0:(e.imdb_rating/10).toPrecision(2)),showMetacriticRating("N/A"==e.metacritic_rating||null==e.metacritic_rating?0:(e.metacritic_rating/100).toPrecision(2)),c.scrollWidth<=768&&document.querySelector(".cast-scroll-button").classList.add("scrolled");let p=JSON.parse(localStorage.getItem("lastRolled")),h={imdbLink:d,poster:e.poster_path?"https://image.tmdb.org/t/p/w185"+e.poster_path:"../images/poster-placeholder.png",title:e.title+" ("+t.getFullYear()+")"};p.unshift(h),p.length>7&&p.pop(),localStorage.setItem("lastRolled",JSON.stringify(p));let g=document.querySelector(".last-rolled-list");g.innerHTML="";for(let e of p){let t=document.createElement("a");t.classList.add("last-rolled-item");let r=document.createElement("img");r.src=e.poster;let o=document.createElement("div");o.textContent=e.title,e.imdbLink&&(t.href=e.imdbLink,t.setAttribute("target","_blank")),t.append(r,o),g.append(t)}scrollToTop(),hideLoadingScreen()}).catch(e=>{if("Not found"==e){let e=showLoadingError("🧐 Nothing was found. Please change search settings and try again.");setTimeout(()=>{hideLoadingScreen(),e.remove()},2e3)}else showLoadingError("🙁 Something went wrong. Please try again later."),console.error(e)})}export async function getMovieInfo(e=null){let t=await rollMovie(e),r=await fetch(`https://api.themoviedb.org/3/movie/${t}?api_key=${TMDB_API}&language=en-US&append_to_response=videos%2Ccredits`),o=await r.json(),i=o.imdb_id,n=await fetch("https://www.omdbapi.com/?apikey=380457ba&i="+i),a=await n.json(),l=o.videos.results[0]?o.videos.results[0].key:"";return{id:o.id,title:o.title,poster_path:o.poster_path,release_date:o.release_date,genres:o.genres,runtime:o.runtime,countries:o.production_countries,tagline:o.tagline,overview:o.overview,cast:o.credits.cast.slice(0,10),trailer:l,director:a.Director,writer:a.Writer,imdb_rating:a.imdbRating,imdb_votes:a.imdbVotes,imdbId:a.imdbID,metacritic_rating:a.Metascore,certification:a.Rated}}export async function rollMovie(e=null){let t=e?e.genres.join(","):"",r=e?e.years[0]+"-01-01":"1900-01-01",o=e?e.years[1]+"-12-31":(new Date).getFullYear()+"-12-31",i=await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_API}&language=en-US&sort_by=popularity.desc&include_adult=false&include_video=false&page=1&primary_release_date.gte=${r}&primary_release_date.lte=${o}&with_genres=${t}`),n=await i.json();if(0==n.total_results)throw"Not found";let a=n.total_results>400?randomInteger(1,400):randomInteger(1,n.total_results),l=Math.ceil(a/20),c=a%20;return c=0==c?19:c-1,i=await fetch(`https://api.themoviedb.org/3/discover/movie?api_key=${TMDB_API}&language=en-US&sort_by=popularity.desc&include_adult=false&include_video=false&page=${l}&primary_release_date.gte=${r}&primary_release_date.lte=${o}&with_genres=${t}`),n=await i.json(),n.results[c].id}export function showImdbRating(e=0){let t=document.querySelector(".imdb-bar");t.innerHTML="";let r,o="#00c853";e<.7&&e>=.5?o="#ffd600":e<.5&&(o="#dd2c00"),r=e?function(e,t){t.path.setAttribute("stroke",e.color),t.path.setAttribute("stroke-width",e.width);var r=Math.round(100*t.value())/10;0===r?t.setText(""):t.setText(r<1?r:r.toPrecision(2))}:function(e,t){t.path.setAttribute("stroke",e.color),t.path.setAttribute("stroke-width",e.width),t.setText("N/A")};let i=new ProgressBar.Circle(t,{color:"#fff",strokeWidth:7,trailWidth:0,easing:"easeInOut",duration:1500,text:{autoStyleContainer:!1},from:{color:o,width:7},to:{color:o,width:7},step:r});i.text.style.fontFamily="sans-serif",i.text.style.fontSize=e?"23px":"18px",i.animate(e)}export function showMetacriticRating(e=0){let t=document.querySelector(".metacritic-bar");t.innerHTML="";let r,o="#00c853";e<.7&&e>=.5?o="#ffd600":e<.5&&(o="#dd2c00"),r=e?function(e,t){t.path.setAttribute("stroke",e.color),t.path.setAttribute("stroke-width",e.width);var r=Math.round(100*t.value());0===r?t.setText(""):t.setText(r)}:function(e,t){t.path.setAttribute("stroke",e.color),t.path.setAttribute("stroke-width",e.width),t.setText("N/A")};let i=new ProgressBar.Circle(t,{color:"#fff",strokeWidth:7,trailWidth:0,easing:"easeInOut",duration:1500,text:{autoStyleContainer:!1},from:{color:o,width:7},to:{color:o,width:7},step:r});i.text.style.fontFamily="sans-serif",i.text.style.fontSize=e?"23px":"18px",i.animate(e)}export function showLoadingScreen(){document.querySelector(".container").classList.add("hidden"),document.querySelector(".loading-screen").classList.add("active")}export function hideLoadingScreen(){document.querySelector(".container").classList.remove("hidden"),document.querySelector(".loading-screen").classList.remove("active")}export function showLoadingError(e){document.querySelector(".sk-chase").style.display="none";let t=document.createElement("div");return t.innerHTML=e,document.querySelector(".loading-screen").append(t),t}export function scrollToTop(){window.scrollTo(0,0)}export function randomInteger(e,t){return Math.floor(Math.random()*(t-e+1))+e}